<ion-header>
  <app-header [pageTitle]="pageTitle"></app-header>
</ion-header>

<ion-content #content>

  <div class="page-container">

    <div id="search-section">

      <ion-searchbar placeholder="הקלד שם {{side == 'c' ? 'ספק' : 'לקוח'}} | מס. הזמנה | מס. חשבונית" [(ngModel)]="query" (ionChange)="searchOrders()">
        <ion-icon src="../../assets/svg/search.svg"></ion-icon>
      </ion-searchbar>
<!--      <div style="width: 60%">-->
<!--        <input #searchInput matInput [matAutocomplete]="autocomplete" [(date)]="query">-->
<!--        <ion-icon src="../../assets/svg/search.svg"></ion-icon>-->
<!--        <mat-autocomplete #autocomplete="matAutocomplete">-->
<!--          <mat-option *ngFor="let option of OrderStatusGroup" [value]="option[0]">{{option[0]}}</mat-option>-->
<!--        </mat-autocomplete>-->
<!--      </div>-->

      <p class="ion-text-center" *ngIf="pageMode != 'drafts'">
        <ion-text color="primary">איתור לפי תאריך אספקה:</ion-text>
      </p>
      <div id="dates" *ngIf="pageMode != 'drafts'">
        <p>בין התאריכים</p>
        <mat-form-field>
          <input matInput [matDatepicker]="fromPicker" [(ngModel)]="fromDate" readonly (dateChange)="toDate ? searchOrders() : ''">
          <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
          <mat-datepicker [touchUi]="ScreenMode == 's'" #fromPicker></mat-datepicker>
        </mat-form-field>
        <p>ל-</p>
        <mat-form-field>
          <input matInput [matDatepicker]="toPicker" [(ngModel)]="toDate" [min]="fromDate" [disabled]="!fromDate" readonly (dateChange)="searchOrders()">
          <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
          <mat-datepicker [touchUi]="ScreenMode == 's'" #toPicker [startAt]="fromDate"></mat-datepicker>
        </mat-form-field>
        <ion-button fill="clear" color="dark" (click)="fromDate = toDate = null; searchOrders()" *ngIf="fromDate">
          <ion-icon slot="icon-only" name="close"></ion-icon>
        </ion-button>
        <ion-item lines="none" [disabled]="fromDate" *ngIf="pageMode != 'edit' && pageMode != 'goods_return'">
          <ion-checkbox slot="start" [(ngModel)]="showPast" (ionChange)="searchOrders()"></ion-checkbox>
          <ion-label>כולל הזמנות שמועד<br>אספקתן חלף</ion-label>
          <ion-button slot="end" class="ion-hide"></ion-button>
        </ion-item>
      </div>

      <div id="statuses" *ngIf="pageMode == 'view'">
        <p class="ion-text-center ion-no-margin">
          <ion-text color="primary">איתור לפי סטטוס הזמנה:</ion-text>
        </p>
        <mat-form-field>
          <mat-select [(ngModel)]="byStatusGroup" placeholder="סטטוס הזמנה" (selectionChange)="searchOrders()">
            <mat-option (click)="byStatusGroup = null">- הכל -</mat-option>
            <mat-option *ngFor="let group of OrderStatusGroup" [value]="[group[0]]">{{group[0] | orderStatusText : true}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </div>

    <div class="table-section">

      <ion-grid class="app-table">

        <div style="display: flex" *ngIf="isSearching">
          <ion-spinner style="margin: auto" color="primary"></ion-spinner>
        </div>

        <div *ngIf="!isSearching && !orders.length">
          <h4 class="ion-text-center">
            <ion-text color="medium">- לא נמצאו מסמכים -</ion-text>
          </h4>
        </div>

        <ion-row *ngIf="orders.length">
          <ion-col>{{pageMode == 'drafts' ? 'תאריך ביצוע' : 'תאריך אספקה'}}</ion-col>
          <ion-col size="1.5">מס. הזמנה</ion-col>
          <ion-col>{{side == 'c' ? 'ספק' : 'לקוח'}}</ion-col>
          <ion-col size="3" *ngIf="pageMode != 'drafts'">סטטוס</ion-col>
          <ion-col></ion-col>
          <ion-col *ngIf="pageMode == 'drafts'"></ion-col>
        </ion-row>

        <app-order-item *ngFor="let order of orders"
                        [order]="order"
                        [actionMode]="pageMode"
                        (deleteDraftClick)="deleteDraft(order.id)"
                        (actionClick)="openOrderProducts(order)"
        ></app-order-item>

      </ion-grid>

    </div>

    <app-pagination
            [page]="page"
            [numOfItems]="orders.length"
            [totalNumOfItems]="null"
            (onForward)="searchOrders(1)"
            (onBack)="searchOrders(-1)"
    ></app-pagination>

    <ion-spinner *ngIf="orderReturn && !orderReturn.products.length" color="primary" style="margin: auto"></ion-spinner>

    <div class="table-section" *ngIf="pageMode == 'goods_return' && orderReturn && orderReturn.products.length" id="return-table">
      <h2 style="font-weight: bold">הזמנה מס. {{orderReturn.serial}}</h2>
      <ion-list id="return-list">
        <app-product-summery *ngFor="let product of orderReturn.products"
                             [productOrder]="product"
                             [showComment]="false"
                             [returnBtn]="true"
                             (returnBtnClicked)="onProductReturn($event)"
        ></app-product-summery>
        <app-products-total-price [price]="orderReturn.orderTotalPrice()" [colSize]="9/4" [colPush]="3+9/4"></app-products-total-price>
      </ion-list>
      <h5 style="font-weight: bold; text-align: center">
        <ion-text>ההזמנה סופקה בתאריך: </ion-text>
        <ion-text color="primary">{{orderReturn.supplyTime | date : 'dd/MM/yyyy HH:mm'}}</ion-text>
      </h5>
    </div>

    <ion-row class="ion-justify-content-end" *ngIf="pageMode == 'drafts' || pageMode == 'goods_return'">
      <ion-button fill="clear" strong="true" style="text-decoration: underline" (click)="navService.goToReturnsDrafts()">מעבר אל טיוטות של החזרות</ion-button>
    </ion-row>

    <ion-row>
      <ion-button shape="round" strong="true" (click)="goBack()" id="back-btn">חזרה למסך הראשי</ion-button>
    </ion-row>

  </div>

</ion-content>
